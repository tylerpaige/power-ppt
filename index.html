<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title></title>
<link rel="stylesheet" type="text/css" href="assets/css/reset.css" />
<link rel="stylesheet" type="text/css" href="assets/css/base.css" />
<link rel="stylesheet" type="text/css" href="assets/css/animations.css" />
<script src="assets/js/jquery-1.10.2.min.js" type="text/javascript"></script>
<script src="assets/js/keypress-1.0.9.min.js" type="text/javascript"></script>
<script>
var cur; // temporarily global var for debugging
$(function() {	
    var transitionEnd = 'transitionend webkitTransitionEnd oTransitionEnd otransitionend animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd',
        index,
        cur = $('#container').children('.slide').eq(0);
    $(cur).addClass('visible');
    
    keypress.combo('right', function() {
    	index = $(cur).siblings('.slide').addBack().index(cur);
    	if(index < $(cur).siblings('.slide').length){
    		target = index+1; 
    		cur = $(cur).siblings('.slide').addBack().eq(target);
    		
    		$(cur).siblings('.slide:lt('+target+').slideLeft').one(transitionEnd, function(){ //if other slides are still moving, wait for them to stop
//    		    $(this).removeClass('slideLeft').removeClass('visible');  then remove their classes
    		    $('.slideLeft').add('.slideRight').not(cur).removeClass('slideLeft slideRight visible');
    		});
    		
        	$(cur).addClass('slideLeft recent').one(transitionEnd, function(){ //when this one finished moving
        	    $(cur).addClass('visible').removeClass('slideLeft recent').siblings().not('.recent').removeClass('visible slideLeft slideRight'); //remove the animation class, add visible class, make sure nothing else is visible
        	}); 
        	$('.recent').not(cur).removeClass('recent');
        }
    });
    keypress.combo('left', function() {
        index = $(cur).siblings('.slide').addBack().index(cur);
        if(index > 0){
            target = index-1;
            cur = $(cur).siblings('.slide').addBack().eq(target);
            
            $(cur).siblings('.slide.slideRight').addBack().filter(':gt('+target+')').one(transitionEnd, function() {
                 $('.slideLeft').add('.slideRight').not(cur).removeClass('slideLeft slideRight visible');
                 console.log('test this selection. cur:', $(cur), 'do not include cur:', $('slideLeft').add('.slideRight'));
//                $(this).removeClass('slideRight').removeClass('visible');
            });
            
            $(cur).addClass('slideRight recent').one(transitionEnd, function() {
                $(cur).addClass('visible').removeClass('slideRight recent').siblings().not('.recent').removeClass('visible slideLeft slideRight');
            });
            $('.recent').not(cur).removeClass('recent');
        }
    });
    keypress.combo('down', function() {
        if($(cur).children('.slide').length > 0){
            cur = $(cur).children('.slide').eq(0);
            $(cur).addClass('slideUp').one(transitionEnd, function() {
                $(this).addClass('visible').removeClass('slideUp').parent('.visible').removeClass('visible');
            });
        }
    });
    keypress.combo('up', function() {
        if($(cur).parent().hasClass('slide')){ // only ascend if the target is a slide, not the container
            $(cur).siblings('.content').addClass('slideDown').one(transitionEnd, function(){
                $(cur).parent().addClass('visible');
                $(cur).removeClass('visible');
                $(cur).siblings('.content').removeClass('slideDown');  
                cur = $(cur).parent(); //Reset after animation end so you don't mess up the selectors
            });
        }
    });
});
</script>	
</head>
<body>
<div id="container">
	<div class="directions">Use the arrow keys to control the Powerpoint</div>
	<div class="slide origin">
		<div class="content">
		    <div class="caption">Slide No. 1. The origin.</div>
		    <div class="img"><img src="images/1.jpg" /></div>
		</div>
		<!-- Tangents -->
		<div class="slide">
			<div class="content">Tangent of Slide #1</div>
			<div class="slide yellow"> 
				<div class="content">Tangent of Tangent of Slide #1</div>
			</div>
		</div>
		<div class="slide origin">
			<div class="content">
    			<div class="caption">Progressing the Tangent of Slide #1</div>
    			<div class="img"><img src="images/2.jpg" /></div>
			</div>
		</div>
		<div class="slide">
			<div class="content">Second progression of the Tangent of Slide #1</div>
		</div>
	</div>
	<div class="slide two">
		<div class="content">
		    <div class="caption white">Slide #2</div>
		    <div class="img"><img src="images/2.jpg" /></div>
		</div>
	</div>
	<div class="slide">
		<div class="content">
		    <div class="caption white">Slide #3</div>
		    <div class="img"><img src="images/3.jpg" /></div>
		</div>
	</div>
	<div class="slide yellow">
		<div class="content">Slide #4</div>
	</div>
	<div class="slide">
		<div class="content">Slide #5</div>
	</div>
	<div class="slide two">
		<div class="content">Slide #6</div>
	</div>
</div>
</body>
</html>


